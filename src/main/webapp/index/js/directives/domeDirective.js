"use strict";!function(e,t){void 0!==e&&e.directive("creatorSelection",["$domeUser",function(e){var t=[];return t.push('  <div class="com-creator-selection">'),t.push('       <div select-con="select-con" class="com-select-con role-select">'),t.push("      <button ng-cloak=\"ng-cloak\" class=\"ui-btn ui-btn-white ui-btn-select\">{{userType=='USER'?'个人':'组'}}<i class=\"icon-down\"></i></button>"),t.push('      <ul class="select-list">'),t.push('        <li class="select-item"><a ng-click="toggleUserType(\'USER\')">个人</a></li>'),t.push('        <li class="select-item"><a ng-click="toggleUserType(\'GROUP\')">组</a></li>'),t.push("      </ul>"),t.push("    </div>"),t.push("    <em ng-show=\"userType=='USER'\" ng-bind=\"'当前用户：'+currentUser.name\"></em>"),t.push('    <div select-con="select-con" class="com-select-con group-select" ng-show="userType==\'GROUP\'">'),t.push('      <button class="ui-btn ui-btn-white ui-btn-select" ng-cloak>{{currentGroup.name}}<i class="icon-down"></i></button>'),t.push('      <ul class="select-list">'),t.push('        <li ng-if="roleList.length===0" class="select-item"><a>无组信息</a></li>'),t.push('        <li ng-repeat="group in roleList" class="select-item"><a ng-bind="group.name" ng-click="toggleGroup(group)"></a></li>'),t.push("      </ul>"),t.push("    </div>"),t.push("  </div>"),{restrict:"AE",template:t.join(""),replace:!0,scope:{defaultUserType:"@",defaultUserId:"=",changeEvent:"&"},link:function(t,s,n){t.userType=t.defaultUserType||"USER",t.currentGroup={},t.currentUser={},t.toggleGroup=function(e){t.currentGroup=e,t.changeEvent({user:e})},t.toggleUserType=function(e){t.userType=e,"USER"==e?t.changeEvent({user:t.currentUser}):t.changeEvent({user:t.currentGroup})},e.userService.getGroupList().then(function(e){t.roleList=e.data.result||[];for(var s=0;s<t.roleList.length;s++)t.defaultUserId&&t.defaultUserType&&t.defaultUserId===t.roleList[s].id&&t.defaultUserType===t.roleList[s].type&&"GROUP"==t.defaultUserType&&(t.currentGroup=t.roleList[s],t.toggleGroup(t.roleList[s])),"USER"===t.roleList[s].type&&(t.currentUser=t.roleList[s],t.roleList.splice(s,1),s--);t.currentGroup.id||t.toggleGroup(t.roleList[0]),t.toggleUserType(t.userType)})}}}]).directive("listScroll",["$window","$document",function(e,t){return{restrict:"A",template:'<div class="com-tabset-scroll"><div class="list-back"><ul class="com-list-tab list-scroll" style="display:inline-block;padding-left:0;" ng-transclude></ul></div></div>',replace:!0,transclude:!0,link:function(s,n,i){var l=angular.element(e),o=angular.element(t),a=n.find("ul"),c=n.find(".nav-option"),u=n.find(".icon-next"),p=n.find(".icon-last"),r=0,d=1,h=0,f=parseInt(i.widthOffset||0);u.bind("click",function(){d<=1||r===d-1||a.stop().animate({marginLeft:(h-48)*-++r},600)}),p.bind("click",function(){0!==r&&(--r,a.stop().animate({marginLeft:(h-48)*-r},600))}),s.safeApply=function(e){var t=this.$root.$$phase;"$apply"==t||"$digest"==t?e&&"function"==typeof e&&e():this.$apply(e)},s.$on("changeScrollList",function(){s.fresh()}),s.fresh=function(){setTimeout(function(){s.safeApply()},100)},s.$watch(function(){return{windowWidth:l.width(),listWidth:a.width()}},function(e,t){1===n.find("li").length?n.height(0):n.height("auto"),h=o.width()-f,d=Math.ceil(e.listWidth/(h-48)),r+1>d&&p.trigger("click"),d<=1?c.hide():c.show(),n.css("max-width",(h>e.listWidth?e.listWidth+15:h)+"px"),t.windowWidth!==e.windowWidth&&(r=0,a.css("margin-left",0))},!0),l.bind("resize",function(){s.$apply()})}}}]).directive("selectInput",function(){var e=[];return e.push('       <div><div select-con label="true" class="com-select-con">'),e.push('        <ul class="selected-labels">'),e.push('          <li ng-repeat="item in selectedList=(optionList|filter:{isSelected:true})" ng-cloak="ng-cloak" class="select-label"><a ng-click="toggleSelect(item);itemClick()" class="icon-cancel"></a>{{item[showKey]}}</li>'),e.push('          <li class="select-input">'),e.push('            <input placeholder="{{placeholder}}" ng-model="keywords.key" ng-keydown="keyDown($event,selectedList,optionListFiltered[0])" class="ui-btn-select"/>'),e.push("          </li>"),e.push("        </ul>"),e.push('        <ul class="select-list">'),e.push('          <li ng-show="optionListFiltered.length===0" class="select-item"><a>无相关信息</a></li>'),e.push('          <li ng-repeat="item in optionListFiltered=(optionList|dynamicKey:showKey:keywords.key|filter:{isSelected:false})" class="select-item" select-input-item ><a ng-click="toggleSelect(item);itemClick()"></a></li>'),e.push("        </ul>"),e.push("      </div></div>"),{restrict:"AE",template:e.join(""),replace:!0,scope:{showKey:"@",optionList:"=",placeholder:"@dPlaceholder",itemClick:"&dClick"},transclude:!0,controller:["$scope","$transclude",function(e,t){this.renderItem=t}],link:function(e){e.optionList||(e.optionList=[]),e.keywords={key:""},e.toggleSelect=function(e){e.isSelected=!e.isSelected},e.keyDown=function(t,s,n){!e.keywords.key&&8==t.keyCode&&s.length>0?e.toggleSelect(s[s.length-1]):13==t.keyCode&&n&&e.toggleSelect(n)}}}}).directive("selectInputItem",function(){return{require:"^selectInput",link:function(e,t,s,n){n.renderItem(e,function(e){t.find("a").append(e)})}}}).directive("domeToggle",function(){return{restrict:"AE",template:'<button class="ui-toggle old-button"></button>',replace:!0}}).directive("loglist",["$util","$domeProject","$filter",function(e,t,s){return{restrict:"AE",template:"<div ng-transclude></div>",transclude:!0,link:function(n,i){n.currentIndex=-1;var l=function(t){var i=n.buildList[t],l=[];if(l.push('<tr class="log-detail">'),l.push('   <td colspan="8">'),l.push('       <ul class="detail-list">'),l.push('           <li class="detail-row">'),l.push('               <span class="detail-title">镜像大小</span>'),l.push('               <span class="detail-content">'+i.imageInfo.imageSize+"MB</span>"),l.push("           </li>"),"Success"==i.state&&(l.push('           <li class="detail-row">'),l.push('               <span class="detail-title">拉取命令</span>'),l.push('               <span class="detail-content">'),l.push('                   <input id="input'+t+'" class="cmd-txt ui-input-white" readonly="true" value="docker pull '+i.imageInfo.registry+"/"+i.imageInfo.imageName+":"+i.imageInfo.imageTag+'"/><a class="link-safe link-copy" id="btn'+t+'" data-clipboard-target="#input'+t+'" data-text="docker pull '+i.imageInfo.registry+"/"+i.imageInfo.imageName+":"+i.imageInfo.imageTag+'">复制</a>'),l.push('                   <p class="cmd-prompt"> 拉取镜像前请登录：docker login domeos.io</p>'),l.push("               </span>"),l.push("           </li>")),i.codeInfo&&i.commitInfo){l.push('           <li class="detail-row">'),l.push('               <span class="detail-title">Branch名称</span>'),l.push('               <span class="detail-content">'+i.codeInfo.codeBranch+"</span>"),l.push("           </li>"),l.push('           <li class="detail-row">'),l.push('               <span class="detail-title">author</span>'),l.push('               <span class="detail-content">'+(null!=i.commitInfo.authorName?i.commitInfo.authorName:"无")+"</span>"),l.push("           </li>"),l.push('           <li class="detail-row">'),l.push('               <span class="detail-title">author email</span>'),l.push('               <span class="detail-content">'+(null!=i.commitInfo.authorEmail?i.commitInfo.authorEmail:"无")+"</span>"),l.push("           </li>"),l.push('           <li class="detail-row">'),l.push('               <span class="detail-title">commit time</span>'),l.push('               <span class="detail-content">'+s("day")(i.commitInfo.createdAt)+"</span>"),l.push("           </li>"),l.push('           <li class="detail-row">'),l.push('               <span class="detail-title">commit info</span>'),l.push('               <span class="detail-content">'+i.commitInfo.message+"</span>"),l.push("           </li>")}return l.push('           <li class="detail-row">'),l.push('               <span class="detail-title">Dockerfile</span>'),l.push('               <span id="dockerfile" class="detail-content">加载中……</span>'),l.push("           </li>"),l.push("       </ul>"),l.push("   </td>"),l.push("</tr>"),e.parseTpl(l.join(""),n.buildList[t])},o=null;n.showDetail=function(e){null!=o&&o.destroy(),o=new Clipboard(".link-copy"),e!=n.currentIndex?(i.find(".log-detail").remove(),i.find("tr:eq("+e+")").after(l(e)),o.on("error",function(e){console.error("Action:",e.action),console.error("Trigger:",e.trigger)}),t.projectService.getBuildDockerfile(n.buildList[e].projectId,n.buildList[e].id).then(function(e){var t=e.data.result;t?(t=t.replace(/[\n\r]/g,"<br/>"),i.find("#dockerfile").html(t)):i.find("#dockerfile").html("无")}),n.currentIndex=e):(0!==i.find(".log-detail").length&&i.find(".log-detail").remove(),n.currentIndex=-1)},n.isNull=function(e){var t=e;return e||(t="无"),t},n.$on("$destroy",function(e){null!=o&&o.destroy()})}}}]).directive("btnCopy",["$util",function(e){return{restrict:"A",scope:{btnCopy:"="},link:function(t,s){e.loadJs("/lib/js/jquery.zclip.js").then(function(){s.zclip({path:"/lib/media/ZeroClipboard.swf",copy:function(){return t.btnCopy}})})}}}]).directive("mirrorCollapse",function(){return{restrict:"A",link:function(e){e.isCollapse=!0,e.toggleCollapse=function(){e.isCollapse=!e.isCollapse}}}}).directive("listNo",function(){return{restrict:"AE",scope:{listLen:"=length",pageno:"=",size:"@"},link:function(e,t){var s,n,i;e.$watch(function(){return e.listLen},function(l){if(n=[],l){for(s=Math.ceil(l/parseInt(e.size)),n.push('<span class="pageno last"><i class="icon-last"></i></span>'),n.push('<span class="pageno turn on">1</span>'),i=2;i<=s;i++)n.push('<span class="pageno turn">'+i+"</span>");n.push('<span class="pageno next"><i class="icon-next"></i></span>'),t.html(n.join(""))}}),t.delegate(".pageno","click",function(){var t=angular.element(this);t.hasClass("turn")?(e.pageno=angular.element(this).html(),angular.element(".pageno.on").removeClass("on"),t.addClass("on")):t.hasClass("last")?1!==e.pageno&&"1"!==e.pageno&&(e.pageno=parseInt(e.pageno)-1,angular.element(".pageno.on").removeClass("on").prev(".pageno").addClass("on")):t.hasClass("next")&&e.pageno<s&&parseInt(e.pageno)<s&&(e.pageno=parseInt(e.pageno)+1,angular.element(".pageno.on").removeClass("on").next(".pageno").addClass("on")),angular.element(".current-page").html(e.pageno),e.$apply()})}}}).directive("fileCollapse",function(){return{restrict:"A",link:function(e){e.showFile=!1,e.showContent=!1,e.toggleFile=function(){e.showFile=!0},e.toggleContent=function(){e.showContent=!e.showContent,e.showFile=!0,e.showContent||""!==e.fileInfo.fileName||""!==e.fileInfo.filePath||(e.showFile=!1)}}}}).directive("customlist",["$util","$domeProject","$domeImage",function(e,t,s){return{restrict:"AE",template:"<div ng-transclude></div>",transclude:!0,link:function(t,n){var i=!1;t.currentIndex=-1;var l=function(){var s=[],n=0===t.customDetailInfo.autoCustom?"Dockerfile":"配置文件",i=0===t.customDetailInfo.publish?"否":"是";if(s.push('<tr class="custom-detail">'),s.push('   <td colspan="9" class="td-detail">'),s.push('       <ul class="com-list-info detail-list">'),s.push("           <li>"),s.push('               <span class="info-name">定制详情</span>'),s.push('               <span class="info-simple">'+n+"</span>"),s.push("           </li>"),"Success"==t.customDetailInfo.state&&(s.push("           <li>"),s.push('               <span class="info-name">镜像大小</span>'),s.push('               <span class="info-simple">{#imageSize}MB</span>'),s.push("           </li>"),s.push("           <li>"),s.push('               <span class="info-name">拉取命令</span>'),s.push('               <div class="info-content cmd-wrap">'),s.push('                   <input class="ui-input-fill" disabled="true" value="docker pull {#registry}/{#imageName}:{#imageTag}"/><button class="ui-btn ui-btn-sm ui-btn-active link-copy" data-text="docker pull {#registry}/{#imageName}:{#imageTag}">复制</button>'),s.push('                   <p class="txt-prompt"> 拉取镜像前请登录：docker login domeos.io</p>'),s.push("               </div>"),s.push("           </li>")),1===t.customDetailInfo.autoCustom){s.push("           <li>"),s.push('               <span class="info-name">环境变量</span>');var l=t.customDetailInfo.envSettings,o=l.length;if(0===o)s.push('               <span class="info-simple">无</span>');else{s.push('               <div class="info-content">'),s.push('                   <table class="ui-table-primary">'),s.push("                       <tr>"),s.push("                           <td>名称</td>"),s.push("                           <td>值</td>"),s.push("                           <td>描述</td>"),s.push("                       </tr>");for(var a=0;a<o;a++)s.push("                       <tr>"),s.push("                           <td>"+l[a].key+"</td>"),s.push("                           <td>"+l[a].value+"</td>"),s.push("                           <td>"+l[a].description+"</td>"),s.push("                       </tr>");s.push("                   </table>"),s.push("               </div>")}s.push("           </li>")}if(s.push("           <li>"),s.push('               <span class="info-name">定制镜像是否作为基础镜像</span>'),s.push('               <span class="info-simple">'+i+"</span>"),s.push("           </li>"),s.push("           <li>"),s.push('               <span class="info-name">定制镜像描述</span>'),null===t.customDetailInfo.description||""===t.customDetailInfo.description?s.push('               <span class="info-simple">无</span>'):s.push('               <span class="info-simple">{#description}</span>'),s.push("           </li>"),s.push("           <li>"),s.push('               <span class="info-name">Dockerfile</span>'),null===t.customDetailInfo.dockerfileContent||""===t.customDetailInfo.dockerfileContent?s.push('               <span class="info-simple">无</span>'):(s.push('               <div class="info-content">'),s.push('                   <textarea readonly="true" class="ui-input-fill file-txt">{#dockerfileContent}</textarea>'),s.push("               </div>")),s.push("           </li>"),1===t.customDetailInfo.autoCustom&&t.customDetailInfo.files){s.push("           <li>"),s.push('               <span class="info-name">配置文件</span>');var c=t.customDetailInfo.files,u=c.length;if(u&&0!==u){s.push('               <div class="info-content">');for(var p=0;p<u;p++)s.push('                   <div class="line-long">'),s.push('                       <p class="con-num">'+(p+1)+"</p>"),s.push('                       <span class="config-title">名称:'+c[p].fileName+"</span>"),s.push('                       <span class="config-title">容器内路径:'+c[p].filePath+"</span>"),s.push("                   </div>"),s.push('                   <textarea readonly="true" class="ui-input-fill file-txt">'+c[p].content+"</textarea>");s.push("               </div>")}else s.push('                   <span class="info-simple">无</span>');s.push("           </li>")}return s.push("           <li>"),s.push('               <button class="ui-btn ui-btn-none btn-pack" >收起<i class="icon-down top"></i></button>'),s.push("           </li>"),s.push("       </ul>"),s.push("   </td>"),s.push("</tr>"),e.parseTpl(s.join(""),t.customDetailInfo)};e.loadJs("/lib/js/jquery.zclip.js").then(function(){i=!0});var o=function(){n.find(".link-copy").zclip({path:"/lib/media/ZeroClipboard.swf",copy:function(){return angular.element(this).data("text")}})},a=function(){n.find(".btn-pack").click(function(){t.$apply(function(){t.currentIndex=-1,n.find(".custom-detail").remove()})})};t.showDetail=function(c,u){c!==t.currentIndex?(s.imageService.getCustomImageInfo(u).then(function(s){t.customDetailInfo=s.data.result||{},n.find(".custom-detail").remove(),n.find("tr:eq("+c+")").after(l()),a(),i?o():e.loadJs("/lib/js/jquery.zclip.js").then(function(){i=!0,o()})}),t.currentIndex=c):(0!==n.find(".custom-detail").length&&n.find(".custom-detail").remove(),t.currentIndex=-1)}}}}]).directive("hoverablePopover",["$rootScope","$timeout",function(e,t){return{restrict:"AE",scope:{content:"=",placeholder:"@"},link:function(s,n){e.insidePopover=!1,n.popover({content:s.content,placement:s.placeholder||"top",html:!0}),n.on("mouseenter",function(){e.insidePopover||n.popover("show")}),n.on("mouseleave",function(){null!==n.context.nextElementSibling&&t(function(){n.context.nextElementSibling.addEventListener("mouseenter",function(){e.insidePopover=!0}),n.context.nextElementSibling.addEventListener("mouseleave",function(){n.popover("hide"),e.insidePopover=!1}),e.insidePopover||(n.popover("hide"),e.insidePopover=!1)},100)})}}}])}(angular.module("domeApp"));
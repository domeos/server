"use strict";!function(e,t){var n=angular.module("userModule",[]);n.controller("ModifyPwModalCtr",["$scope","loginUser","$modalInstance","dialog","$domeUser",function(e,t,n,o,r){e.pwObj={username:t.username,oldpassword:"",newpassword:""},e.newPwAgain="",e.modiftPw=function(){r.userService.userModifyPw(e.pwObj).then(function(){o.alert("提示","修改成功，请重新登录！").then(function(){location.href="/login/login.html?redirect="+encodeURIComponent(location.href)})},function(){o.error("警告","修改失败，请重试！")})},e.cancel=function(){n.dismiss("cancel")}}]).controller("ModifyUserInfoCtr",["$scope","user","$publicApi","$modalInstance","dialog",function(e,t,n,o,r){e.user=t,e.cancel=function(){o.dismiss()},e.submit=function(){var e={id:t.id,username:t.username,email:t.email,phone:t.phone};n.modifyUserInfo(e).then(function(){r.alert("提示","修改成功！"),o.close(e)},function(e){r.error("修改失败",e.data.resultMsg)})}}]),n.factory("$domeUser",["$http","$q","dialog","$domeGlobal","$domeModel",function(e,t,n,o,r){var i={},u=function(r){var i=t.defer();return o.getGloabalInstance("git").getData().then(function(t){if(t=t.filter(function(e){return e.id===r.gitlabId}),t[0]&&t[0].url){var o=t[0].url;e.post(o+"/api/v3/session",angular.toJson(r),{ignore401:!0}).then(function(e){var t=e.data;return{name:t.username,token:t.private_token,gitlabId:r.gitlabId}},function(){i.reject()}).then(function(t){e.post("/api/project/git/gitlabinfo",angular.toJson(t)).then(function(e){i.resolve(e.data.result)},function(){i.reject()})},function(){i.reject()})}else n.error("警告","未配置代码仓库地址！"),i.reject()},function(){i.reject()}),i.promise},s={getCurrentUser:function(){return e.get("/api/user/get")},getUserList:function(){return e.get("/api/user/list")},modifyUserInfo:function(t){return e.post("/api/user/modify",angular.toJson(t))},modifyPw:function(t){return e.post("/api/user/adminChangePassword",angular.toJson(t))},userModifyPw:function(t){return e.post("/api/user/changePassword",angular.toJson(t))},deleteUser:function(t){return e.delete("/api/user/delete/"+t)},createUser:function(t){return e.post("/api/user/create",angular.toJson(t))},getResourceUserRole:function(t,n){return e.get("/api/user/resource/"+t+"/"+n)},getSigResourceUser:function(t,n){return e.get("/api/resource/"+t+"/"+n)},getResourceList:function(t){return e.get("/api/collections/"+t)},getResourceUser:function(t){return e.get("/api/resource/"+t+"/useronly")},modifyResourceUser:function(t){return e.put("/api/resource",angular.toJson(t))},deleteResourceUser:function(t,n,o,r){return e.delete("/api/resource/"+t+"/"+n+"/"+o+"/"+r)},getGroupList:function(){return e.get(" /api/namespace/list")},getGroup:function(){return e.get("/api/group/list")},getGroupInfo:function(t){return e.get("/api/group/get/"+t)},deleteGroup:function(t){return e.delete("/api/group/delete/"+t)},createGroup:function(t){return e.post("/api/group/create",angular.toJson(t))},modifyGroupUsers:function(t,n){return e.post("/api/group_members/"+t,angular.toJson(n))},deleteGroupUser:function(t,n){return e.delete("/api/group_members/"+t+"/"+n)},getGroupUser:function(t){return e.get("/api/group_members/"+t)},logout:function(){location.href="/api/user/logout?from="+encodeURIComponent(location.protocol+"//"+location.host)},deleteCollectionUser:function(t,n,o){return e.delete("/api/collection_members/"+t+"/"+n+"/"+o)},modifyUserRole:function(t){return e.post("/api/collection_members/single",angular.toJson(t))},addCollectionUsers:function(t){return e.post("/api/collection_members/multiple",angular.toJson(t))},addOneCollectionUser:function(t){return e.post("/api/collection_members/single",angular.toJson(t))},getCollectionUser:function(t,n){return e.get("/api/collection_members/"+t+"/"+n)},createCollectionUser:function(t){return e.post("/api/collection_members/multiple",angular.toJson(t))},getCollectionList:function(t){return e.post("/api/collections/"+resourceType)}};return{userService:s,relatedGitLab:u,getLoginUser:function(){var e=t.defer();return i.id?e.resolve(i):s.getCurrentUser().then(function(t){i=t.data.result,e.resolve(i)}),e.promise}}}]),e.userModule=n}(window);